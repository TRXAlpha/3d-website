<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Ping Pong Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const ball = document.querySelector('#ball');
        const paddle1 = document.querySelector('#paddle1');
        const paddle2 = document.querySelector('#paddle2');

        // Paddle movement
        document.addEventListener('keydown', (event) => {
          switch (event.key) {
            case 'i':
              paddle1.object3D.position.y += 0.1;
              paddle1.setAttribute('position', paddle1.object3D.position);
              break;
            case 'k':
              paddle1.object3D.position.y -= 0.1;
              paddle1.setAttribute('position', paddle1.object3D.position);
              break;
          }
        });

        // Function to start the game
        function startGame() {
          console.log('Starting game...');
          
          // Move ball to player's side and apply boost
          ball.object3D.position.set(-1.5, 1, 0);
          ball.setAttribute('position', { x: -2.5, y: 3, z: 0 });

          // Ensure dynamic-body is present
          ball.setAttribute('dynamic-body', 'shape: sphere; mass: 1');

          // Apply initial velocity
          ball.body.velocity.set(2, 0, 0); // Adjust initial velocity as needed
          
          console.log('Ball position:', ball.object3D.position);
          console.log('Ball velocity:', ball.body.velocity);
        }

        // Start the game on key press
        document.addEventListener('keypress', (event) => {
          if (event.key === ' ') { // Spacebar
            startGame();
          }
        });

        // AI Paddle Movement function
        function moveAIPaddle() {
          if (ball.object3D.position.y > paddle2.object3D.position.y) {
            paddle2.object3D.position.y += 0.05;
            paddle2.setAttribute('position', paddle2.object3D.position);
          } else if (ball.object3D.position.y < paddle2.object3D.position.y) {
            paddle2.object3D.position.y -= 0.05;
            paddle2.setAttribute('position', paddle2.object3D.position);
          }

          requestAnimationFrame(moveAIPaddle);
        }

        moveAIPaddle(); // Start AI paddle movement

        // Handle collisions with paddles
        ball.addEventListener('collide', (event) => {
          const target = event.detail.body.el;
          console.log('Ball collided with', target.id);

          if (target === paddle1 || target === paddle2) {
            // Reverse ball's x-velocity
            ball.body.velocity.x *= -1;
          }
        });
      });
    </script>
  </head>
  <body>
    <a-scene physics="gravity: -9.8">
      <!-- Ping Pong Table -->
      <a-box position="0 0.5 0" depth="10" height="0.2" width="5" color="#2E8B57" static-body></a-box> <!-- Sea Green -->

      <!-- Paddles -->
      <a-box id="paddle1" position="-2.3 1 0" depth="0.2" height="1" width="0.2" color="blue" static-body></a-box>
      <a-box id="paddle2" position="2.3 1 0" depth="0.2" height="1" width="0.2" color="red" static-body></a-box>

      <!-- Ball -->
      <a-sphere id="ball" position="0 1 0" radius="0.2" color="white" dynamic-body="shape: sphere; mass: 1"></a-sphere>

      <!-- Japan Scenery -->
      <a-entity environment="preset: japan"></a-entity>
    </a-scene>
  </body>
</html>
