<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Ping Pong Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const paddle1 = document.querySelector("#paddle1");
        const paddle2 = document.querySelector("#paddle2");
        const ball = document.querySelector("#ball");
        const startText = document.querySelector("#startText");
        let gameStarted = false;

        let ballVelocity = { x: 0, y: 0, z: 0 };

        document.addEventListener("keydown", function (event) {
          if (!gameStarted) {
            if (event.key === " ") {
              // Start the game
              ballVelocity = { x: 0, y: 0, z: -0.2 }; // Set velocity towards the player
              ball.setAttribute("velocity", ballVelocity);
              startText.setAttribute("visible", false); // Hide the start text
              gameStarted = true;
              return;
            }
          } else {
            let leftPosition = paddle1.getAttribute("position");

            switch (event.key) {
              case "i":
                if (leftPosition.y < 2) {
                  leftPosition.y += 0.1;
                }
                if (leftPosition.y > 2) {
                  leftPosition.y = 2;
                }
                paddle1.setAttribute("position", leftPosition);
                break;
              case "k":
                if (leftPosition.y > 0.5) {
                  leftPosition.y -= 0.1;
                }
                if (leftPosition.y < 0.5) {
                  leftPosition.y = 0.5;
                }
                paddle1.setAttribute("position", leftPosition);
                break;
              case "j":
                if (leftPosition.z > -2) {
                  leftPosition.z -= 0.1;
                }
                if (leftPosition.z < -2) {
                  leftPosition.z = -2;
                }
                paddle1.setAttribute("position", leftPosition);
                break;
              case "l":
                if (leftPosition.z < 2) {
                  leftPosition.z += 0.1;
                }
                if (leftPosition.z > 2) {
                  leftPosition.z = 2;
                }
                paddle1.setAttribute("position", leftPosition);
                break;
            }
          }
        });

        function moveAIPaddle() {
          if (gameStarted) {
            let ballPosition = ball.getAttribute("position");
            let rightPosition = paddle2.getAttribute("position");

            if (ballPosition.y > rightPosition.y && rightPosition.y < 2) {
              rightPosition.y += 0.05;
            } else if (
              ballPosition.y < rightPosition.y &&
              rightPosition.y > 0.5
            ) {
              rightPosition.y -= 0.05;
            }
            if (ballPosition.z > rightPosition.z && rightPosition.z < 2) {
              rightPosition.z += 0.05;
            } else if (
              ballPosition.z < rightPosition.z &&
              rightPosition.z > -2
            ) {
              rightPosition.z -= 0.05;
            }
            paddle2.setAttribute("position", rightPosition);
          }
        }

        setInterval(moveAIPaddle, 100); // Move AI paddle at a set interval
      });
    </script>
  </head>
  <body>
    <a-scene physics="debug: true">
      <!-- Uncomment for knowing directions of objects -->
      <a-entity
        camera
        position="-4 1.8 0"
        rotation="0 -90 0"
        look-controls="enabled: false"
      ></a-entity>

      <!-- Lighting -->
      <a-entity
        light="type: directional; color: #EEE; intensity: 0.5"
        position="-1 1 1"
      ></a-entity>
      <a-entity light="type: ambient; color: #445451"></a-entity>

      <a-text
        id="startText"
        value="Press Space to Start"
        align="center"
        position="0 2 1.5"
        width="4"
        color="#FFF"
      ></a-text>

      <!-- Table -->
      <a-box
        static-body
        position="0 0.25 0"
        width="4"
        height="0.1"
        depth="2"
        color="#4CAF50"
      ></a-box>

      <!-- Middle Line -->
      <a-box
        static-body
        position="0 0.25 0"
        width="0.2"
        height="0.1"
        depth="2"
        color="#FFF"
      ></a-box>

      <!-- Right Line -->
      <a-box
        static-body
        position="2 0.25 0"
        width="0.1"
        height="0.1"
        depth="2"
        color="#FFF"
      ></a-box>

      <!-- Left Line -->
      <a-box
        static-body
        position="-2 0.25 0"
        width="0.1"
        height="0.1"
        depth="2"
        color="#FFF"
      ></a-box>

      <!-- Long Line, towards the camera -->
      <a-box
        static-body
        position="0 0.25 1"
        width="4"
        height="0.1"
        depth="0.1"
        color="#FFF"
      ></a-box>

      <!-- Long Line, opposite the camera -->
      <a-box
        static-body
        position="0 0.25 -1"
        width="4"
        height="0.1"
        depth="0.1"
        color="#FFF"
      ></a-box>

      <!-- Ball -->
      <a-sphere
        id="ball"
        dynamic-body
        position="0 0.5 0"
        radius="0.1"
        color="#EF2D5E"
      ></a-sphere>

      <!-- Auto Driven Paddle -->
      <a-box
        id="paddle2"
        position="1.5 0.5 0"
        width="0.1"
        height="0.2"
        depth="0.6"
        color="#FFC65D"
      ></a-box>

      <!-- Player-Driven Paddle -->
      <a-box
        id="paddle1"
        position="-1.5 0.5 0"
        width="0.1"
        height="0.2"
        depth="0.6"
        color="#FFC65D"
      ></a-box>

      <!-- Environment -->
      <a-entity environment="preset: japan"></a-entity>
    </a-scene>
  </body>
</html>
